FROM alpine:latest

# Install required packages
RUN apk add --no-cache ca-certificates

# Copy and extract dgraph
COPY dgraph_v24.1.3.tgz /tmp/
RUN tar -xzf /tmp/dgraph_v24.1.3.tgz -C /usr/local/bin/ && \
    rm /tmp/dgraph_v24.1.3.tgz && \
    chmod +x /usr/local/bin/dgraph

# Create dgraph user and directory
RUN adduser -D -s /bin/sh dgraph && \
    mkdir -p /dgraph && \
    chown dgraph:dgraph /dgraph

USER dgraph
WORKDIR /dgraph

EXPOSE 5080 6080 8080 9080

ENTRYPOINT ["dgraph"]